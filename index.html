<html>
  <head>
    <style>
      .navBar {
        display: flex;
        justify-content: flex-start;
      }
      a {
        margin-right: 20px;
      }
      #Home {
        display: flex;
        justify-content: center;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script
      src="https://unpkg.com/react@16/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.0/react-router-dom.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { HashRouter, Link, Route, NavLink } = ReactRouterDOM;

      const Home = () => {
        return (
          <div id="home">
            <h1>Home</h1>
          </div>
        );
      };

      const Navbar = () => {
        return (
          <div>
            <div className="navBar">
              <NavLink to="/" activeClassName="active">
                Home
              </NavLink>
              <NavLink to="/users" activeClassName="active">
                Users
              </NavLink>
            </div>
            <hr />
          </div>
        );
      };

      class Pager extends React.Component {

        render() {
          const {count} = this.props
          return (
            <h1>Total Users: {count}</h1>
          )
        }
      }

      const UsersTable = (props) => {
        const users = props.users
        return (
          <div id="tableContainer">
            <table>
                <tbody>
              <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Title</th>
              </tr>
              {
                users.map(user => {
                  return (
                    <tr key={user.id}>
                  <td>{user.firstName}</td>
                  <td>{user.lastName}</td>
                  <td>{user.email}</td>
                  <td>{user.title}</td>
                </tr>
                  )
                })
              }

              </tbody>
            </table>
          </div>
        )
      }

      class Users extends  React.Component {
        constructor() {
          super()
          this.state = {
            users: [],
            count: 0
          }
        }

        async componentDidUpdate(prevProps) {
          if(prevProps.match.params.userId !== this.props.match.params.userId) {
            const idx = this.props.match.params.userId
            const results = await axios.get(`https://acme-users-api-rev.herokuapp.com/api/users/${idx ? idx : ''}`)
            const { users } = results.data
            this.setState({ users })
          }
        }
        async componentDidMount() {
          const idx = this.props.match.params.userId
          const results = await axios.get(`https://acme-users-api-rev.herokuapp.com/api/users/${idx ? idx : ''}`)
          const { users, count } = results.data
          this.setState({ users, count })
        }
        render() {
          const {users, count} = this.state
         return (
           <div id="userContainer">
            <Pager count={count}/>
            <UsersTable users={ users }/>
          </div>
           )
        }
      }

      class App extends React.Component {
        render() {
          return (
            <HashRouter>
              <div>
                <h1>Acme Users</h1>
                <Navbar />
              </div>
              <Route exact path="/" component={ Home } />
              <Route exact path="/users/" component={ Users } />
              <Route path="/users/:userId" component= {Users} />
            </HashRouter>
          );
        }
      }

      const root = document.querySelector("#root");
      ReactDOM.render(<App />, root);
    </script>
  </body>
</html>
